# Generated by Django 4.2.8 on 2024-03-20 07:50

from django.db import migrations, models


def create_projects(apps, schema_editor):
    Proposal = apps.get_model("proposal", "Proposal")
    Project = apps.get_model("structure", "Project")

    for proposal in Proposal.objects.all():
        if not proposal.project:
            project = Project.objects.create(
                customer=proposal.round.call.manager.customer,
                name=proposal.project_summary
                if proposal.project_summary
                else proposal.created_by.username + " | " + proposal.round.call.name,
            )
            proposal.project = project
            proposal.save()


class Migration(migrations.Migration):
    dependencies = [
        ("proposal", "0023_remove_proposal_supporting_documentation"),
        ("structure", "0043_rename_divisions_to_organization_groups"),
    ]

    operations = [
        migrations.AddField(
            model_name="proposal",
            name="allocation_comment",
            field=models.CharField(blank=True, max_length=150, null=True),
        ),
        migrations.RunPython(create_projects),
        migrations.AddField(
            model_name="requestedresource",
            name="limits",
            field=models.JSONField(blank=True, default=dict),
        ),
    ]
